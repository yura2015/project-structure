(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{10:function(e,t,n){"use strict";function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"a",(function(){return i}));class i{constructor({items:e=[]}={}){s(this,"onPointerMove",({clientX:e,clientY:t})=>{this.moveDraggingAt(e,t);const n=this.placeholderElement.previousElementSibling,s=this.placeholderElement.nextElementSibling,{firstElementChild:i,lastElementChild:r}=this.element,{top:o}=i.getBoundingClientRect(),{bottom:l}=this.element.getBoundingClientRect();if(t<o)return i.before(this.placeholderElement);if(t>l)return r.after(this.placeholderElement);if(n){const{top:e,height:s}=n.getBoundingClientRect();if(t<e+s/2)return n.before(this.placeholderElement)}if(s){const{top:e,height:n}=s.getBoundingClientRect();if(t>e+n/2&&s.nextElementSibling)return s.after(this.placeholderElement);if(!s.nextElementSibling)return s.before(this.placeholderElement)}this.scrollIfCloseToWindowEdge(t)}),s(this,"onPointerUp",()=>{this.dragStop()}),this.items=e,this.render()}render(){this.element=document.createElement("ul"),this.element.className="sortable-list",this.addItems(),this.initEventListeners()}addItems(){for(const e of this.items)e.classList.add("sortable-list__item");this.element.append(...this.items)}initEventListeners(){this.element.addEventListener("pointerdown",e=>{this.onPointerDown(e)})}onPointerDown(e){const t=e.target.closest(".sortable-list__item");t&&(e.target.closest("[data-grab-handle]")&&(e.preventDefault(),this.dragStart(t,e)),e.target.closest("[data-delete-handle]")&&(e.preventDefault(),t.remove()))}createPlaceholderElement(e,t){const n=document.createElement("li");return n.className="sortable-list__placeholder",n.style.width=e+"px",n.style.height=t+"px",n}dragStart(e,{clientX:t,clientY:n}){this.draggingElem=e,this.elementInitialIndex=[...this.element.children].indexOf(e);const{x:s,y:i}=e.getBoundingClientRect(),{offsetWidth:r,offsetHeight:o}=e;this.pointerShift={x:t-s,y:n-i},this.draggingElem.style.width=r+"px",this.draggingElem.style.height=o+"px",this.draggingElem.classList.add("sortable-list__item_dragging"),this.placeholderElement=this.createPlaceholderElement(r,o),this.draggingElem.after(this.placeholderElement),this.element.append(this.draggingElem),this.moveDraggingAt(t,n),this.addDocumentEventListeners()}addDocumentEventListeners(){document.addEventListener("pointermove",this.onPointerMove),document.addEventListener("pointerup",this.onPointerUp)}removeDocumentEventListeners(){document.removeEventListener("pointermove",this.onPointerMove),document.removeEventListener("pointerup",this.onPointerUp)}moveDraggingAt(e,t){this.draggingElem.style.left=e-this.pointerShift.x+"px",this.draggingElem.style.top=t-this.pointerShift.y+"px"}scrollIfCloseToWindowEdge(e){e<20?window.scrollBy(0,-10):e>document.documentElement.clientHeight-20&&window.scrollBy(0,10)}dragStop(){const e=[...this.element.children].indexOf(this.placeholderElement);this.draggingElem.style.cssText="",this.draggingElem.classList.remove("sortable-list__item_dragging"),this.placeholderElement.replaceWith(this.draggingElem),this.draggingElem=null,this.removeDocumentEventListeners(),e!==this.elementInitialIndex&&this.dispatchEvent("sortable-list-reorder",{from:this.elementInitialIndex,to:e})}dispatchEvent(e,t){this.element.dispatchEvent(new CustomEvent(e,{bubbles:!0,details:t}))}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.removeDocumentEventListeners(),this.element=null}}},6:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return a}));var s=n(10),i=n(9);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class o{constructor({url:e="",refs:t="",sort:n="",isSortLocally:s=!1}={}){r(this,"element",void 0),r(this,"sortedlists",void 0),r(this,"subElements",{}),r(this,"data",[]),r(this,"handler",async e=>{const t=e.target.closest("[data-id]");t&&t.classList.toggle("category_open");const n=e.target.closest("[data-grab-handle]");if(n){const e=new CustomEvent("pointerdown");n.dispatchEvent(e)}}),this.url=new URL(e,"https://course-js.javascript.ru/"),this.isSortLocally=s,this.sort="weight",this.refs="subcategory",this.render(),this.loadData(this.sort,this.refs)}addEventListeners(){this.element.addEventListener("pointerdown",this.handler)}render(){const e=document.createElement("div");e.innerHTML=this.getTemplate();const t=e.firstElementChild;this.element=t,this.subElements=this.getSubElements(t)}getTemplate(){return' <div class="content" id="content">\n                <div class="categories">\n                   <div class="content__top-panel">\n                     <h1 class="page_title">Категории товаров</h1>\n                   </div>\n                   <div data-element="categoriesConteiner" >\n                    </div>\n                </div>\n             </div>'}async loadData(e,t){this.url.searchParams.set("_sort",e),this.url.searchParams.set("_refs",t);const n=await Object(i.a)(this.url);this.renderRows(n)}getTables(e=[]){if(!e.length)return[];const t=[];for(let n of e){const e=this.getTable(n);t.push(e)}return t}getTable(e){const t=document.createElement("div");t.innerHTML=`\n            <div class="category_open" data-id="${e.id}">\n               <header class="category__header">${e.title}</header>\n            </div>`;const n=t.firstElementChild;n.dataset.id=""+e.id,n.classList.add("category"),n.classList.add("category_open");const s=this.getSubcategories(e.subcategories);return n.querySelector(".category__header").after(s),n}getSubcategories(e=[]){const t=document.createElement("div");t.innerHTML='\n            <div class="category__body">\n                <div class="subcategory-list" ></div>\n           </div> \n           ';const n=t.firstElementChild,s=this.initSortableList(e);return n.querySelector(".subcategory-list").append(s),n}initSortableList(e){const t=e.map(e=>this.getListItem(e.id,e.title,e.count));return new s.a({items:t}).element}getListItem(e,t,n){const s=document.createElement("div");return s.innerHTML=`\n        <li class="categories__sortable-list-item sortable-list__item" data-grab-handle>\n        <strong >${t} </strong>\n        <span> <b>${n}</b> products</span>\n        </li>`,s.firstElementChild.dataset.id=""+e,s.firstElementChild}renderRows(e){e.length&&this.addRows(e)}addRows(e=[]){this.data=e;const t=this.getTables(this.data),n=this.element.querySelector("[data-element]");for(let e of t)n.insertAdjacentElement("beforeend",e);this.addEventListeners()}getSubElements(e){const t={},n=e.querySelectorAll("[data-element]");for(const e of n)t[e.dataset.element]=e;return t}remove(){this.element.remove()}destroy(){this.remove(),this.subElements={}}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(){l(this,"element",void 0),l(this,"subElements",{}),l(this,"components",{})}initComponents(){const e=new o({url:"api/rest/categories",refs:"subcategory",sort:"weight"});this.components={categories:e}}randerComponents(){Object.keys(this.components).forEach(e=>{const t=this.subElements[e],{element:n}=this.components[e];t.append(n)})}get template(){return'\n        <div class="content" id="content">\n          <div data-element="categories">\n          </div>\n        <div>\n        '}render(){return this.element=document.createElement("div"),this.element.innerHTML=this.template,this.subElements=this.getSubElements(this.element),this.initComponents(),this.randerComponents(),this.element}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}initEventListener(){this.components.rangePicker.element.addEventListener("date-select",e=>{const{from:t,to:n}=e.detail;this.updateComponents(t,n)})}remove(){this.element&&this.element.remove()}destroy(){this.remove();for(let e in this.components)this.components[e].destroy();this.element=null,this.subElements={}}}},9:function(e,t,n){"use strict";t.a=async function(e,t){let n,i;try{n=await fetch(e.toString(),t)}catch(e){throw new s(n,"Network error has occurred.")}if(!n.ok){let e=n.statusText;try{i=await n.json(),e=i.error&&i.error.message||i.data&&i.data.error&&i.data.error.message||e}catch(e){}let t=`Error ${n.status}: ${e}`;throw new s(n,i,t)}try{return await n.json()}catch(e){throw new s(n,null,e.message)}};class s extends Error{constructor(e,t,n){var s,i,r;super(n),r="FetchError",(i="name")in(s=this)?Object.defineProperty(s,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[i]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{e.reason instanceof s&&alert(e.reason.message)})}}]);
//# sourceMappingURL=categories-index-js-1.js.map