{"version":3,"sources":["webpack:///./src/components/sortable-list/index.js","webpack:///./src/utils/escape-html.js","webpack:///./src/components/product-form/index.js","webpack:///./src/pages/products/edit/index.js","webpack:///./src/utils/fetch-json.js"],"names":["SortableList","constructor","items","clientX","clientY","this","moveDraggingAt","prevElem","placeholderElement","previousElementSibling","nextElem","nextElementSibling","firstElementChild","lastElementChild","element","top","firstElementTop","getBoundingClientRect","bottom","before","after","height","scrollIfCloseToWindowEdge","dragStop","render","document","createElement","className","addItems","initEventListeners","item","classList","add","append","addEventListener","event","onPointerDown","target","closest","preventDefault","dragStart","remove","createPlaceholderElement","width","style","draggingElem","elementInitialIndex","children","indexOf","x","y","offsetWidth","offsetHeight","pointerShift","addDocumentEventListeners","onPointerMove","onPointerUp","removeDocumentEventListeners","removeEventListener","left","window","scrollBy","documentElement","clientHeight","placeholderIndex","cssText","replaceWith","dispatchEvent","from","to","type","details","CustomEvent","bubbles","destroy","string","replace","BACKEND_URL","ProductForm","productId","title","description","quantity","subcategory","status","images","price","discount","fileInput","accept","onchange","async","file","files","formData","FormData","uploadImage","imageListContainer","subElements","disabled","result","fetchJson","method","headers","Authorization","body","getImageItem","data","link","name","hidden","appendChild","click","template","createCategoriesSelect","defaultFormData","categoriesPromise","loadCategoriesList","productPromise","loadProductData","categoriesData","productResponse","Promise","all","productData","categories","renderForm","setFormData","createImagesList","innerHTML","getEmptyTemplate","getSubElements","product","getFormData","JSON","stringify","id","productForm","excludedFields","formatToNumber","fields","Object","keys","filter","includes","getValue","field","querySelector","values","value","parseInt","imagesHTMLCollection","querySelectorAll","image","push","url","src","source","alt","detail","forEach","wrapper","select","category","child","subcategories","Option","outerHTML","elements","dataset","map","sortableList","escapeHtml","onSubmit","Page","initComponents","components","root","randerComponents","reduce","accum","subElement","component","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","error","message","Error","super","reason","alert"],"mappings":"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","file":"products-edit-index-js-4.js","sourcesContent":["export default class SortableList {\r\n  \r\n  onPointerMove = ({ clientX, clientY }) => {\r\n    this.moveDraggingAt(clientX, clientY);\r\n\r\n    const prevElem = this.placeholderElement.previousElementSibling;\r\n    const nextElem = this.placeholderElement.nextElementSibling;\r\n\r\n    const { firstElementChild, lastElementChild } = this.element;\r\n    const { top: firstElementTop } = firstElementChild.getBoundingClientRect();\r\n    const { bottom } = this.element.getBoundingClientRect();\r\n\r\n    if (clientY < firstElementTop) {\r\n      return firstElementChild.before(this.placeholderElement);\r\n    }\r\n\r\n    if (clientY > bottom) {\r\n      return lastElementChild.after(this.placeholderElement);\r\n    }\r\n\r\n    if (prevElem) {\r\n      const { top, height } = prevElem.getBoundingClientRect();\r\n      const middlePrevElem = top + height / 2;\r\n\r\n      if (clientY < middlePrevElem) {\r\n        return prevElem.before(this.placeholderElement);\r\n      }\r\n    }\r\n\r\n    if (nextElem) {\r\n      const { top, height } = nextElem.getBoundingClientRect();\r\n      const middleNextElem = top + height / 2;\r\n\r\n      if (clientY > middleNextElem && nextElem.nextElementSibling) {\r\n        return nextElem.after(this.placeholderElement);\r\n      } else if (!nextElem.nextElementSibling ) {\r\n           return nextElem.before(this.placeholderElement);\r\n      } \r\n    }\r\n\r\n    this.scrollIfCloseToWindowEdge(clientY);\r\n  };\r\n\r\n  onPointerUp = () => {\r\n    this.dragStop();\r\n  };\r\n\r\n  constructor({ items = [] } = {}) {\r\n    this.items = items;\r\n\r\n    this.render();\r\n  }\r\n\r\n  render() {\r\n    this.element = document.createElement('ul');\r\n    this.element.className = 'sortable-list';\r\n\r\n    this.addItems();\r\n    this.initEventListeners();\r\n  }\r\n\r\n  addItems() {\r\n    // item is a DOM element\r\n    for (const item of this.items) {\r\n      item.classList.add('sortable-list__item');\r\n    }\r\n\r\n    this.element.append(...this.items);\r\n  }\r\n\r\n  initEventListeners () {\r\n    this.element.addEventListener('pointerdown', event => {\r\n      this.onPointerDown(event);\r\n    });\r\n  }\r\n\r\n  onPointerDown (event) {\r\n    const element = event.target.closest('.sortable-list__item');\r\n\r\n    if (element) {\r\n      if (event.target.closest('[data-grab-handle]')) {\r\n        event.preventDefault();\r\n        this.dragStart(element, event);\r\n      }\r\n\r\n      if (event.target.closest('[data-delete-handle]')) {\r\n        event.preventDefault();\r\n\r\n        element.remove();\r\n      }\r\n    }\r\n  }\r\n\r\n  createPlaceholderElement (width, height) {\r\n    const element = document.createElement('li');\r\n\r\n    element.className = 'sortable-list__placeholder';\r\n    element.style.width = `${width}px`;\r\n    element.style.height = `${height}px`;\r\n\r\n    return element;\r\n  }\r\n\r\n  dragStart(element, {clientX, clientY}) {\r\n    this.draggingElem = element;\r\n    this.elementInitialIndex = [...this.element.children].indexOf(element);\r\n\r\n    const { x, y } = element.getBoundingClientRect();\r\n    const { offsetWidth, offsetHeight } = element;\r\n\r\n    this.pointerShift = {\r\n      x: clientX - x,\r\n      y: clientY - y\r\n    };\r\n\r\n    this.draggingElem.style.width = `${offsetWidth}px`;\r\n    this.draggingElem.style.height = `${offsetHeight}px`;\r\n    this.draggingElem.classList.add('sortable-list__item_dragging');\r\n\r\n    this.placeholderElement = this.createPlaceholderElement(offsetWidth, offsetHeight);\r\n\r\n    this.draggingElem.after(this.placeholderElement);\r\n    // move to the end, to be over other list elements\r\n    this.element.append(this.draggingElem);\r\n    this.moveDraggingAt(clientX, clientY);\r\n    this.addDocumentEventListeners();\r\n  }\r\n\r\n  addDocumentEventListeners () {\r\n    document.addEventListener('pointermove', this.onPointerMove);\r\n    document.addEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  removeDocumentEventListeners () {\r\n    document.removeEventListener('pointermove', this.onPointerMove);\r\n    document.removeEventListener('pointerup', this.onPointerUp);\r\n  }\r\n\r\n  moveDraggingAt(clientX, clientY) {\r\n    this.draggingElem.style.left = `${clientX - this.pointerShift.x}px`;\r\n    this.draggingElem.style.top = `${clientY - this.pointerShift.y}px`;\r\n  }\r\n\r\n  scrollIfCloseToWindowEdge(clientY) {\r\n    const scrollingValue = 10;\r\n    const threshold = 20;\r\n\r\n    if (clientY < threshold) {\r\n      window.scrollBy(0, -scrollingValue);\r\n    } else if (clientY > document.documentElement.clientHeight - threshold) {\r\n      window.scrollBy(0, scrollingValue);\r\n    }\r\n  }\r\n\r\n  dragStop() {\r\n    const placeholderIndex = [...this.element.children].indexOf(this.placeholderElement);\r\n\r\n    this.draggingElem.style.cssText = '';\r\n    this.draggingElem.classList.remove('sortable-list__item_dragging');\r\n    this.placeholderElement.replaceWith(this.draggingElem);\r\n    this.draggingElem = null;\r\n\r\n    this.removeDocumentEventListeners();\r\n\r\n    if (placeholderIndex !== this.elementInitialIndex) {\r\n      this.dispatchEvent('sortable-list-reorder', {\r\n        from: this.elementInitialIndex,\r\n        to: placeholderIndex\r\n      });\r\n    }\r\n  }\r\n\r\n  dispatchEvent (type, details) {\r\n\r\n    this.element.dispatchEvent(new CustomEvent(type, {\r\n      bubbles: true,\r\n      details\r\n    }));\r\n\r\n  }\r\n\r\n  remove () {\r\n    if (this.element) {\r\n      this.element.remove();\r\n    }\r\n  }\r\n\r\n  destroy () {\r\n    this.remove();\r\n    this.removeDocumentEventListeners();\r\n    this.element = null;\r\n  }\r\n}","export default string => string\r\n  .replace(/&/g, '&amp;')\r\n  .replace(/\"/g, '&quot;')\r\n  .replace(/'/g, '&#39;')\r\n  .replace(/</g, '&lt;')\r\n  .replace(/>/g, '&gt;');\r\n","//import SortableList from '../../2-sortable-list/index.js';\r\nimport SortableList from '../sortable-list/index.js';\r\nimport escapeHtml from '../../utils/escape-html.js';\r\nimport fetchJson from '../../utils/fetch-json.js';\r\n\r\nconst IMGUR_CLIENT_ID = `${process.env.IMGUR_CLIENT_ID}`;\r\nconst BACKEND_URL = `${process.env.BACKEND_URL}`; \r\n\r\nexport default class ProductForm {\r\n  element;\r\n  subElements = {};\r\n  defaultFormData = {\r\n    title: '',\r\n    description: '',\r\n    quantity: 1,\r\n    subcategory: '',\r\n    status: 1,\r\n    images: [],\r\n    price: 100,\r\n    discount: 0\r\n  };\r\n\r\n    uploadImage = () => {\r\n    const fileInput = document.createElement('input');\r\n\r\n    fileInput.type = 'file';\r\n    fileInput.accept = 'image/*';\r\n\r\n    fileInput.onchange = async () => {\r\n      const [file] = fileInput.files;\r\n\r\n      if (file) {\r\n        const formData = new FormData();\r\n        const { uploadImage, imageListContainer } = this.subElements;\r\n\r\n        formData.append('image', file);\r\n\r\n        uploadImage.classList.add('is-loading');\r\n        uploadImage.disabled = true;\r\n\r\n        const result = await fetchJson('https://api.imgur.com/3/image', {\r\n          method: 'POST',\r\n          headers: {\r\n            Authorization: `Client-ID ${IMGUR_CLIENT_ID}`\r\n          },\r\n          body: formData,\r\n        });\r\n\r\n        imageListContainer.firstElementChild.append(this.getImageItem(result.data.link, file.name));\r\n\r\n        uploadImage.classList.remove('is-loading');\r\n        uploadImage.disabled = false;\r\n\r\n        // Remove input from body\r\n        fileInput.remove();\r\n      }\r\n    };\r\n\r\n    // must be in body for IE\r\n    fileInput.hidden = true;\r\n    document.body.appendChild(fileInput);\r\n    fileInput.click();\r\n  };\r\n\r\n  constructor(productId) {\r\n    this.productId = productId;\r\n  }\r\n\r\n  template() {\r\n    return `\r\n      <div class=\"product-form\">\r\n      <form data-element=\"productForm\" class=\"form-grid\">\r\n        <div class=\"form-group form-group__half_left\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Название товара</label>\r\n            <input required\r\n              id=\"title\"\r\n              value=\"\"\r\n              type=\"text\"\r\n              name=\"title\"\r\n              class=\"form-control\"\r\n              data-element=\"title\"\r\n              placeholder=\"Название товара\"></input>\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Описание</label>\r\n          <textarea required\r\n            id=\"description\"\r\n            class=\"form-control\"\r\n            name=\"description\"\r\n            placeholder=\"Описание товара\"></textarea>\r\n        </div>\r\n        <div class=\"form-group form-group__wide\">\r\n          <label class=\"form-label\">Фото</label>\r\n          <div data-element=\"imageListContainer\"></div>\r\n          <button data-element=\"uploadImage\" type=\"button\" class=\"button-primary-outline\">\r\n            <span>Загрузить</span>\r\n          </button>\r\n        </div>\r\n        <div class=\"form-group form-group__half_left\">\r\n          <label class=\"form-label\">Категория</label>\r\n            ${this.createCategoriesSelect()}\r\n        </div>\r\n        <div class=\"form-group form-group__half_left form-group__two-col\">\r\n          <fieldset>\r\n            <label class=\"form-label\">Цена ($)</label>\r\n            <input required\r\n              id=\"price\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"price\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.price}\"></input>\r\n          </fieldset>\r\n          <fieldset>\r\n            <label class=\"form-label\">Скидка ($)</label>\r\n            <input required\r\n              id=\"discount\"\r\n              value=\"\"\r\n              type=\"number\"\r\n              name=\"discount\"\r\n              class=\"form-control\"\r\n              placeholder=\"${this.defaultFormData.discount}\"></input>\r\n          </fieldset>\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Количество</label>\r\n          <input required\r\n            id=\"quantity\"\r\n            value=\"\"\r\n            type=\"number\"\r\n            class=\"form-control\"\r\n            name=\"quantity\"\r\n            placeholder=\"${this.defaultFormData.quantity}\"></input>\r\n        </div>\r\n        <div class=\"form-group form-group__part-half\">\r\n          <label class=\"form-label\">Статус</label>\r\n          <select id=\"status\" class=\"form-control\" name=\"status\">\r\n            <option value=\"1\">Активен</option>\r\n            <option value=\"0\">Неактивен</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"form-buttons\">\r\n          <button type=\"submit\" name=\"save\" class=\"button-primary-outline\">\r\n            ${this.productId ? 'Сохранить' : 'Добавить'} товар\r\n          </button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n    `;\r\n  }\r\n\r\n  async render() {\r\n    const categoriesPromise = this.loadCategoriesList();\r\n    const productPromise = this.productId\r\n      ? this.loadProductData(this.productId)\r\n      : [this.defaultFormData];\r\n\r\n    const [categoriesData, productResponse] = await Promise.all([categoriesPromise, productPromise]);\r\n    const [productData] = productResponse;\r\n\r\n    this.formData = productData;\r\n    this.categories = categoriesData;\r\n\r\n    this.renderForm();\r\n\r\n    if (this.formData) {\r\n      this.setFormData();\r\n      this.createImagesList();\r\n      this.initEventListeners();\r\n    }\r\n\r\n    return this.element;\r\n  }\r\n\r\n  renderForm() {\r\n    const element = document.createElement('div');\r\n\r\n    element.innerHTML = this.formData\r\n      ? this.template()\r\n      : this.getEmptyTemplate();\r\n\r\n    this.element = element.firstElementChild;\r\n\r\n    this.subElements = this.getSubElements(this.element);\r\n  }\r\n\r\n  getEmptyTemplate() {\r\n    return `<div>\r\n      <h1 class=\"page-title\">Страница не найдена</h1>\r\n      <p>Извините, данный товар не существует</p>\r\n    </div>`;\r\n  }\r\n\r\n  async save() {\r\n    const product = this.getFormData();\r\n    const result = await fetchJson(`${BACKEND_URL}api/rest/products`, {\r\n      method: this.productId ? 'PATCH' : 'PUT',\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify(product)\r\n    });\r\n\r\n    this.dispatchEvent(result.id);\r\n  }\r\n\r\n  getFormData() {\r\n    const { imageListContainer, productForm } = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const formatToNumber = ['price', 'quantity', 'discount', 'status'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n    const getValue = field => productForm.querySelector(`[name=${field}]`);\r\n    const values = {};\r\n\r\n    for (const field of fields) {\r\n      const value = getValue(field);\r\n\r\n      values[field] = formatToNumber.includes(field)\r\n        ? parseInt(value, 10)\r\n        : value;\r\n    }\r\n\r\n    const imagesHTMLCollection = imageListContainer.querySelectorAll('.sortable-table__cell-img');\r\n\r\n    values.images = [];\r\n    values.id = this.productId;\r\n\r\n    for (const image of imagesHTMLCollection) {\r\n      values.images.push({\r\n        url: image.src,\r\n        source: image.alt\r\n      });\r\n    }\r\n\r\n    return values;\r\n  }\r\n\r\n  dispatchEvent(id) {\r\n    const event = this.productId\r\n      ? new CustomEvent('product-updated', { detail: id })\r\n      : new CustomEvent('product-saved');\r\n\r\n    this.element.dispatchEvent(event);\r\n  }\r\n\r\n  setFormData() {\r\n    const { productForm } = this.subElements;\r\n    const excludedFields = ['images'];\r\n    const fields = Object.keys(this.defaultFormData).filter(item => !excludedFields.includes(item));\r\n\r\n    fields.forEach(item => {\r\n      const element = productForm.querySelector(`#${item}`);\r\n\r\n      element.value = this.formData[item] || this.defaultFormData[item];\r\n    });\r\n  }\r\n\r\n  loadProductData(productId) {\r\n    return fetchJson(`${BACKEND_URL}api/rest/products?id=${productId}`);\r\n  }\r\n\r\n  loadCategoriesList() {\r\n    return fetchJson(`${BACKEND_URL}api/rest/categories?_sort=weight&_refs=subcategory`);\r\n  }\r\n\r\n  createCategoriesSelect() {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = '<select class=\"form-control\" id=\"subcategory\" name=\"subcategory\"></select>';\r\n\r\n    const select = wrapper.firstElementChild;\r\n\r\n    for (const category of this.categories) {\r\n      for (const child of category.subcategories) {\r\n        select.append(new Option(`${category.title} > ${child.title}`, child.id));\r\n      }\r\n    }\r\n\r\n    return select.outerHTML;\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const subElements = {};\r\n    const elements = element.querySelectorAll('[data-element]');\r\n\r\n    for (const item of elements) {\r\n      subElements[item.dataset.element] = item;\r\n    }\r\n\r\n    return subElements;\r\n  }\r\n\r\n  createImagesList() {\r\n    const { imageListContainer } = this.subElements;\r\n    const { images } = this.formData;\r\n\r\n    const items = images.map(({ url, source }) => this.getImageItem(url, source));\r\n\r\n    const sortableList = new SortableList({\r\n      items\r\n    });\r\n\r\n    imageListContainer.append(sortableList.element);\r\n  }\r\n\r\n  getImageItem(url, name) {\r\n    const wrapper = document.createElement('div');\r\n\r\n    wrapper.innerHTML = `\r\n      <li class=\"products-edit__imagelist-item sortable-list__item\">\r\n        <span>\r\n          <img src=\"../icons/icon-grab.svg\" data-grab-handle alt=\"grab\">\r\n          <img class=\"sortable-table__cell-img\" alt=\"${escapeHtml(name)}\" src=\"${escapeHtml(url)}\">\r\n          <span>${escapeHtml(name)}</span>\r\n        </span>\r\n        <button type=\"button\">\r\n          <img src=\"../icons/icon-trash.svg\" alt=\"delete\" data-delete-handle>\r\n        </button>\r\n      </li>`;\r\n\r\n    return wrapper.firstElementChild;\r\n  }\r\n\r\n  initEventListeners() {\r\n    const { productForm, uploadImage } = this.subElements;\r\n\r\n    productForm.addEventListener('submit', this.onSubmit);\r\n    uploadImage.addEventListener('click', this.uploadImage);\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.subElements = null;\r\n  }\r\n\r\n  remove() {\r\n    this.element.remove();\r\n  }\r\n}","import ProductForm from '../../../components/product-form/index.js';\r\n\r\nconst IMGUR_CLIENT_ID = `${process.env.IMGUR_CLIENT_ID}`;\r\nconst BACKEND_URL = `${process.env.BACKEND_URL}`; \r\n\r\nexport default class Page {\r\n    element;\r\n    subElements = {};\r\n    components = {};\r\n\r\n    constructor(productId) {\r\n        this.productId = productId;\r\n  }\r\n  \r\n  initComponents() {\r\n        \r\n        const productForm =  new ProductForm(this.productId);\r\n\r\n        this.components = {\r\n            productForm\r\n        };\r\n    }\r\n\r\n    async randerComponents() {\r\n        const root = this.element.querySelector('[data-element]');\r\n        const renderForm = await this.components.productForm.render();\r\n        root.append(renderForm);\r\n    }\r\n\r\n\r\n    get template() {\r\n        return ` \r\n             <div class=\"products-edit\">\r\n              <div class=\"content__top-panel\">\r\n                <h1 class=\"page-title\">\r\n                  <a href=\"/products\" class=\"link\">Товары</a> / Редактировать\r\n                </h1>\r\n              </div>\r\n              <div  data-element=\"productForm\"></div>\r\n            </div>`\r\n           \r\n    }\r\n     render() {\r\n        \r\n        this.element = document.createElement('div'); // (*)\r\n        this.element.innerHTML = this.template;\r\n        this.element = this.element.firstElementChild;\r\n        this.subElements = this.getSubElements(this.element);\r\n\r\n        this.initComponents();\r\n        this.randerComponents() ;\r\n        return this.element;\r\n     }\r\n\r\n     getSubElements(element) {\r\n         const elements = element.querySelectorAll('[data-element]');\r\n         return [...elements].reduce((accum, subElement) => {\r\n            accum[subElement.dataset.element] = subElement;\r\n            return accum;\r\n        }, {});\r\n     }\r\n\r\n      remove () {\r\n        if (this.element) {\r\n            this.element.remove();\r\n        }\r\n     }\r\n\r\n      destroy() {\r\n        this.remove();\r\n        for(let component in this.components) {\r\n            this.components[component].destroy();\r\n        }\r\n        this.element = null;\r\n        this.subElements = {};\r\n      }\r\n\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\n\r\nexport default async function(url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // NOTE: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch(err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText = (body.error && body.error.message) || (body.data && body.data.error && body.data.error.message) || errorText;\r\n    } catch (error) { /* ignore failed body */ }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch(err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener('unhandledrejection', event => {\r\n  if (event.reason instanceof FetchError) {\r\n    alert(event.reason.message);\r\n  }\r\n});\r\n\r\n"],"sourceRoot":""}